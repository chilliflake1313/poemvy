<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Poemvy â€“ Home</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@100;200;300;400;500;600;700;800;900&family=Geist:wght@100;200;300;400;500;600;700;800;900&family=IBM+Plex+Mono:wght@100;200;300;400;500;600;700&family=IBM+Plex+Sans:wght@100;200;300;400;500;600;700&family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Nunito:wght@200;300;400;500;600;700;800;900&family=PT+Serif:wght@400;700&family=Roboto+Slab:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&family=Shantell+Sans:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --background: #000000;
        --foreground: #a1d3f8;
        --border: #00000014;
        --input: #0b2b3a;
        --primary: #3576a2;
        --primary-foreground: #001b2e;
        --secondary: #3b5d6d;
        --secondary-foreground: #a1d3f8;
        --muted: #6e8f99;
        --muted-foreground: #6e8f99;
        --success: #3b5d6d;
        --success-foreground: #a1d3f8;
        --accent: #a1d3f8;
        --accent-foreground: #001b2e;
        --destructive: #2b4756;
        --destructive-foreground: #a1d3f8;
        --warning: #3b5d6d;
        --warning-foreground: #a1d3f8;
        --card: #0b2b3a;
        --card-foreground: #cfeffb;
        --sidebar: #071826;
        --sidebar-foreground: #a1d3f8;
        --sidebar-primary: #062233;
        --sidebar-primary-foreground: #a1d3f8;
        --radius-sm: 4px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 24px;
        --font-family-body: Inter;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        background: #000000;
        overflow-x: hidden;
        color: #c1d9e8;
        font-size: 15px;
        line-height: 1.6;
        display: flex;
        justify-content: center;
        min-height: 100vh;
        font-family:
          Inter,
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          Helvetica,
          Arial,
          sans-serif;
      }

      #bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        pointer-events: none;
      }

      button,
      input,
      textarea {
        font-family:
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          Helvetica,
          Arial,
          sans-serif;
      }

      .app-shell {
        width: 100%;
        max-width: 1440px;
        padding: 0 24px 48px;
        display: flex;
        flex-direction: column;
      }

      /* Header Styles */
      header {
        position: sticky;
        top: 0;
        z-index: 20;
        backdrop-filter: blur(18px);
      }

      .top-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 0;
        height: 64px;
        border-bottom: 1px solid rgba(110, 143, 153, 0.35);
        border-radius: var(--radius-md);
        background: linear-gradient(
          to bottom,
          rgba(0, 0, 0, 0.96),
          rgba(0, 0, 0, 0.9)
        );
      }

      .logo-mark {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        text-decoration: none;
      }

      .logo-icon-wrap {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(53, 118, 162, 0.2);
      }

      .logo-text {
        font-size: 18px;
        font-weight: 500;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        color: #a1d3f8;
      }

      .search-container {
        flex: 1;
        max-width: 480px;
        margin: 0 32px;
      }

      .search-bar {
        width: 100%;
        padding: 8px 16px 8px 40px;
        background: rgba(11, 43, 58, 0.6);
        border: 1px solid rgba(53, 118, 162, 0.3);
        border-radius: 999px;
        color: rgba(193, 217, 232, 0.95);
        font-size: 14px;
        outline: none;
        transition: all 0.2s;
        position: relative;
      }

      .search-bar::placeholder {
        color: rgba(110, 143, 153, 0.7);
      }

      .search-bar:focus {
        border-color: rgba(53, 118, 162, 0.6);
        background: rgba(11, 43, 58, 0.8);
      }

      .search-wrapper {
        position: relative;
      }

      .search-icon {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(110, 143, 153, 0.7);
        pointer-events: none;
      }

      .nav-links {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 14px;
        font-weight: 500;
      }

      .nav-link {
        position: relative;
        color: rgba(161, 211, 248, 0.7);
        text-decoration: none;
        cursor: pointer;
        white-space: nowrap;
        padding: 8px 20px;
        border-radius: 999px;
        transition: all 0.25s ease;
        background: transparent;
      }

      .nav-link:hover {
        color: rgba(161, 211, 248, 1);
        background: rgba(53, 118, 162, 0.2);
      }

      .nav-link[data-active="true"] {
        color: #ffffff;
        background: rgba(53, 118, 162, 0.4);
        border: 1px solid rgba(53, 118, 162, 0.3);
      }

      .nav-link-label {
        position: relative;
        z-index: 1;
      }

      .nav-link-underline {
        display: none;
      }

      /* Main Layout */
      main {
        display: flex;
        justify-content: center;
        padding-top: 32px;
      }

      .feed-shell {
        width: 100%;
        max-width: 720px;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .section-title {
        font-size: 14px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: rgba(110, 143, 153, 0.7);
      }

      /* Composer Styles */
      .composer {
        background: rgba(11, 43, 58, 0.6);
        border: 1px solid rgba(53, 118, 162, 0.2);
        border-radius: var(--radius-lg);
        padding: 16px 18px 14px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .composer-top {
        display: flex;
        gap: 12px;
        align-items: flex-start;
      }

      .avatar-circle {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        overflow: hidden;
        background-color: var(--secondary);
        flex-shrink: 0;
        cursor: pointer;
        transition: opacity 0.2s;
      }

      .avatar-circle:hover {
        opacity: 0.8;
      }

      .avatar-circle img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .composer-input-shell {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .composer-placeholder {
        min-height: 48px;
        color: rgba(161, 211, 248, 0.5);
        font-size: 16px;
        line-height: 1.7;
      }

      .composer-meta-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 4px;
      }

      .composer-hints {
        display: flex;
        gap: 10px;
        font-size: 12px;
        color: rgba(110, 143, 153, 0.8);
      }

      .composer-hint-chip {
        padding: 4px 8px;
        border-radius: var(--radius-xl);
        background: rgba(59, 93, 109, 0.7);
        color: rgba(161, 211, 248, 0.7);
        white-space: nowrap;
      }

      .composer-actions {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .icon-button {
        width: 28px;
        height: 28px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: rgba(110, 143, 153, 0.8);
        cursor: pointer;
        transition: color 0.2s;
      }

      .icon-button:hover {
        color: rgba(161, 211, 248, 0.9);
      }

      .publish-btn {
        margin-left: auto;
        padding: 6px 16px;
        border-radius: 999px;
        background: rgba(53, 118, 162, 0.5);
        color: rgba(161, 211, 248, 0.95);
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        white-space: nowrap;
        border: 1px solid rgba(53, 118, 162, 0.3);
        transition: all 0.2s;
      }

      .publish-btn:hover {
        background: rgba(53, 118, 162, 0.7);
        color: #ffffff;
      }

      /* Poem Card Styles */
      .poem-feed {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      article.poem-card {
        background: rgba(11, 43, 58, 0.9);
        border: 1px solid rgba(53, 118, 162, 0.15);
        border-radius: var(--radius-lg);
        padding: 16px 18px 12px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .poem-header-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
      }

      .poem-author-block {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .author-meta {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .author-name-row {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .author-name {
        font-size: 14px;
        font-weight: 500;
        color: #a1d3f8;
      }

      .author-handle {
        font-size: 13px;
        color: var(--muted-foreground);
      }

      .poem-header-right {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .follow-btn {
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(53, 118, 162, 0.4);
        color: rgba(161, 211, 248, 0.95);
        font-size: 12px;
        font-weight: 500;
        border: 1px solid rgba(53, 118, 162, 0.3);
        cursor: pointer;
        white-space: nowrap;
        transition: all 0.2s;
      }

      .follow-btn:hover {
        background: rgba(53, 118, 162, 0.6);
        color: #ffffff;
      }

      .poem-timestamp {
        font-size: 12px;
        color: rgba(110, 143, 153, 0.85);
        white-space: nowrap;
      }

      .poem-body {
        font-size: 16px;
        line-height: 1.8;
        color: rgba(193, 217, 232, 0.95);
        white-space: pre-line;
      }

      .poem-footer-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 4px;
      }

      .poem-actions {
        display: flex;
        gap: 18px;
        font-size: 12px;
        color: rgba(110, 143, 153, 0.9);
      }

      .poem-action-item {
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        white-space: nowrap;
        transition: all 0.3s ease;
      }

      .poem-action-item.liked iconify-icon {
        color: #ff4757 !important;
        filter: drop-shadow(0 0 8px rgba(255, 71, 87, 0.6));
      }

      .poem-action-item.liked .poem-action-count {
        color: #ff4757;
      }

      .poem-action-item.bookmarked iconify-icon {
        color: #ffa502 !important;
      }

      .poem-action-item.bookmarked .poem-action-count {
        color: #ffa502;
      }

      .poem-card .comments-section.expanded ~ .poem-footer-row .comment-toggle-btn iconify-icon,
      .comment-toggle-btn.active iconify-icon {
        color: #3576a2 !important;
      }

      .poem-card .comments-section.expanded ~ .poem-footer-row .comment-toggle-btn .poem-action-count,
      .comment-toggle-btn.active .poem-action-count {
        color: #3576a2;
      }

      .poem-action-count {
        min-width: 10px;
      }

      .poem-tagline {
        font-size: 11px;
        color: rgba(110, 143, 153, 0.8);
      }

      /* Comments Section */
      .comments-section {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s ease-out;
        border-top: 1px solid rgba(110, 143, 153, 0.15);
        margin-top: 16px;
      }

      .comments-section.expanded {
        max-height: 2000px;
        transition: max-height 0.5s ease-in;
      }

      .comments-container {
        padding: 16px 0;
      }

      .comment-input-wrapper {
        display: flex;
        gap: 12px;
        padding: 12px 0;
        border-bottom: 1px solid rgba(110, 143, 153, 0.1);
        margin-bottom: 16px;
        align-items: center;
      }

      .comment-input-wrapper .avatar-circle {
        width: 32px;
        height: 32px;
        flex-shrink: 0;
      }

      .comment-input {
        flex: 1;
        background: rgba(110, 143, 153, 0.05);
        border: 1px solid rgba(110, 143, 153, 0.15);
        border-radius: 20px;
        padding: 8px 16px;
        font-size: 13px;
        color: rgba(255, 255, 255, 0.95);
        outline: none;
        transition: all 0.2s ease;
        font-family: inherit;
      }

      .comment-input::placeholder {
        color: rgba(110, 143, 153, 0.6);
      }

      .comment-input:focus {
        background: rgba(110, 143, 153, 0.08);
        border-color: rgba(53, 118, 162, 0.3);
        color: rgba(255, 255, 255, 1);
      }

      .comment-submit-btn {
        padding: 6px 18px;
        background: rgba(53, 118, 162, 0.5);
        border: 1px solid rgba(53, 118, 162, 0.3);
        border-radius: 20px;
        color: rgba(161, 211, 248, 0.95);
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
      }

      .comment-submit-btn:hover {
        background: rgba(53, 118, 162, 0.7);
        color: #ffffff;
      }

      .comment-item {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
        position: relative;
      }

      .comment-item .avatar-circle {
        width: 32px;
        height: 32px;
        flex-shrink: 0;
      }

      .comment-content {
        flex: 1;
      }

      .comment-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;
      }

      .comment-author {
        font-weight: 600;
        font-size: 13px;
        color: rgba(255, 255, 255, 0.95);
      }

      .comment-time {
        font-size: 11px;
        color: rgba(110, 143, 153, 0.7);
      }

      .comment-text {
        font-size: 13px;
        line-height: 1.5;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 6px;
      }

      .comment-actions {
        display: flex;
        gap: 16px;
        font-size: 11px;
        color: rgba(110, 143, 153, 0.8);
      }

      .comment-action {
        cursor: pointer;
        transition: color 0.2s ease;
      }

      .comment-action:hover {
        color: rgba(53, 118, 162, 0.9);
      }

      .comment-replies {
        margin-left: 44px;
        margin-top: 12px;
        position: relative;
      }

      /* Connecting line for nested comments */
      .comment-replies::before {
        content: '';
        position: absolute;
        left: -28px;
        top: 0;
        bottom: 16px;
        width: 2px;
        background: rgba(110, 143, 153, 0.15);
      }

      .comment-replies .comment-item::before {
        content: '';
        position: absolute;
        left: -28px;
        top: 16px;
        width: 20px;
        height: 2px;
        background: rgba(110, 143, 153, 0.15);
      }

      .comment-replies .comment-item:last-child::after {
        content: '';
        position: absolute;
        left: -28px;
        top: 16px;
        bottom: -16px;
        width: 2px;
        background: rgba(239, 248, 255, 1);
      }

      .show-more-comments {
        text-align: center;
        padding: 12px;
        color: rgba(53, 118, 162, 0.8);
        font-size: 13px;
        cursor: pointer;
        transition: color 0.2s ease;
      }

      .show-more-comments:hover {
        color: rgba(53, 118, 162, 1);
      }

      /* Floating Write Button */
      .floating-write-btn {
        position: fixed;
        bottom: 32px;
        right: 32px;
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: linear-gradient(135deg, #3576a2 0%, #5a9fc9 100%);
        color: #ffffff;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 8px 24px rgba(53, 118, 162, 0.4);
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .floating-write-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 12px 32px rgba(53, 118, 162, 0.6);
      }

      .composer {
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .composer:hover {
        border-color: rgba(53, 118, 162, 0.4);
        background: rgba(11, 43, 58, 0.7);
      }

      /* Profile Dropdown */
      .profile-dropdown {
        position: relative;
      }

      .profile-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        white-space: nowrap;
        padding: 6px 12px 6px 6px;
        border-radius: 999px;
        transition: all 0.25s ease;
        background: transparent;
        border: none;
        color: rgba(161, 211, 248, 0.7);
      }

      .profile-btn:hover {
        background: rgba(53, 118, 162, 0.2);
        color: rgba(161, 211, 248, 1);
      }

      .profile-btn img {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid rgba(53, 118, 162, 0.4);
      }

      .dropdown-menu {
        position: absolute;
        top: calc(100% + 8px);
        right: 0;
        min-width: 180px;
        background: rgba(11, 43, 58, 0.95);
        border: 1px solid rgba(53, 118, 162, 0.3);
        border-radius: var(--radius-md);
        padding: 8px;
        display: none;
        flex-direction: column;
        gap: 4px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(12px);
        z-index: 1000;
      }

      .dropdown-menu.show {
        display: flex;
      }

      .dropdown-item {
        padding: 10px 14px;
        border-radius: var(--radius-sm);
        color: rgba(161, 211, 248, 0.9);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .dropdown-item:hover {
        background: rgba(53, 118, 162, 0.3);
        color: #e8f4fb;
      }

      /* Notification Bell */
      .notification-btn {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        color: rgba(161, 211, 248, 0.7);
        cursor: pointer;
        white-space: nowrap;
        padding: 8px 20px;
        border-radius: 999px;
        transition: all 0.25s ease;
        background: transparent;
        border: none;
      }

      .notification-btn:hover {
        color: rgba(161, 211, 248, 1);
        background: rgba(53, 118, 162, 0.2);
      }

      .notification-badge {
        position: absolute;
        top: 8px;
        right: 16px;
        width: 8px;
        height: 8px;
        background: #ff6b6b;
        border-radius: 50%;
        border: 2px solid rgba(0, 0, 0, 0.96);
      }

      /* Share Menu */
      .share-menu-container {
        position: relative;
      }

      .share-menu {
        position: absolute;
        top: calc(100% + 8px);
        right: 0;
        min-width: 200px;
        background: rgba(11, 43, 58, 0.98);
        border: 1px solid rgba(53, 118, 162, 0.3);
        border-radius: var(--radius-md);
        padding: 8px;
        display: none;
        flex-direction: column;
        gap: 4px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(12px);
        z-index: 1000;
      }

      .share-menu.show {
        display: flex;
      }

      .share-menu-item {
        padding: 10px 14px;
        border-radius: var(--radius-sm);
        color: rgba(161, 211, 248, 0.9);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 10px;
        background: transparent;
        border: none;
        width: 100%;
        text-align: left;
      }

      .share-menu-item:hover {
        background: rgba(53, 118, 162, 0.3);
        color: #e8f4fb;
      }

      .share-menu-item iconify-icon {
        width: 18px;
        height: 18px;
        flex-shrink: 0;
      }

      .share-menu-divider {
        height: 1px;
        background: rgba(53, 118, 162, 0.2);
        margin: 4px 0;
      }
    </style>
  </head>
  <body>
    <canvas id="bg"></canvas>
    <div class="app-shell">
      <header>
        <div class="top-nav">
          <div class="logo-mark" data-media-type="banani-button">
            <div class="logo-icon-wrap">
              <iconify-icon
                icon="lucide:feather"
                style="font-size: 20px; color: var(--accent)"
              ></iconify-icon>
            </div>
            <div class="logo-text">Poemvy</div>
          </div>
          <div class="search-container">
            <div class="search-wrapper">
              <iconify-icon
                icon="lucide:search"
                class="search-icon"
                style="font-size: 16px"
              ></iconify-icon>
              <input
                type="text"
                class="search-bar"
                placeholder="Search poems, poets, or themes..."
              />
            </div>
          </div>
          <nav class="nav-links">
            <a
              class="nav-link"
              data-media-type="banani-button"
              data-active="true"
            >
              <span class="nav-link-label">Home</span>
            </a>
            <button class="notification-btn" title="Notifications">
              <iconify-icon icon="lucide:bell" width="20"></iconify-icon>
              <span class="notification-badge"></span>
            </button>
            <div class="profile-dropdown">
              <button class="profile-btn" onclick="toggleDropdown()">
                <img
                  src="https://storage.googleapis.com/banani-avatars/avatar%2Ffemale%2F25-35%2FEuropean%2F2"
                  alt="Your profile"
                />
              </button>
              <div class="dropdown-menu" id="profileDropdown">
                <a href="profile.html" class="dropdown-item">
                  <iconify-icon icon="lucide:user" width="16"></iconify-icon>
                  Profile
                </a>
                <a href="account.html" class="dropdown-item">
                  <iconify-icon icon="lucide:settings" width="16"></iconify-icon>
                  Account
                </a>
                <a href="#" class="dropdown-item">
                  <iconify-icon icon="lucide:sliders" width="16"></iconify-icon>
                  Settings
                </a>
              </div>
            </div>
          </nav>
        </div>
      </header>

      <main>
        <section class="feed-shell" aria-label="Poem feed">
          <section class="composer" aria-label="Write a new poem" onclick="window.location.href='write.html'">
            <div class="composer-top">
              <div class="avatar-circle" onclick="window.location.href='profile.html'">
                <img
                  src="https://storage.googleapis.com/banani-avatars/avatar%2Ffemale%2F25-35%2FEuropean%2F2"
                  alt="Your avatar"
                />
              </div>
              <div class="composer-input-shell">
                <div class="composer-placeholder">
                  What is your soul whispering?
                </div>
              </div>
            </div>
            <div class="composer-meta-row">
              <div class="composer-hints">
                <div class="composer-hint-chip">free verse</div>
                <div class="composer-hint-chip">haiku</div>
                <div class="composer-hint-chip">midnight thoughts</div>
              </div>
              <div class="composer-actions">
                <div class="icon-button" data-media-type="banani-button">
                  <iconify-icon
                    icon="lucide:image"
                    style="font-size: 16px; color: currentColor"
                  ></iconify-icon>
                </div>
                <div class="icon-button" data-media-type="banani-button">
                  <iconify-icon
                    icon="lucide:mic"
                    style="font-size: 16px; color: currentColor"
                  ></iconify-icon>
                </div>
                <div class="icon-button" data-media-type="banani-button">
                  <iconify-icon
                    icon="lucide:sparkles"
                    style="font-size: 16px; color: currentColor"
                  ></iconify-icon>
                </div>
                <div class="publish-btn" data-media-type="banani-button">
                  Publish
                </div>
              </div>
            </div>
          </section>

          <section class="poem-feed" aria-label="Recent poems">
            <article class="poem-card" data-media-type="banani-button" data-poem-id="poem1">
              <div class="poem-header-row">
                <div class="poem-author-block">
                  <div class="avatar-circle" onclick="window.location.href='profile.html'">
                    <img
                      src="https://storage.googleapis.com/banani-avatars/avatar%2Ffemale%2F18-25%2FEast%20Asian%2F3"
                      alt="Mei Ling"
                    />
                  </div>
                  <div class="author-meta">
                    <div class="author-name-row">
                      <span class="author-name">Mei Ling</span>
                      <button
                        class="follow-btn"
                        data-media-type="banani-button"
                      >
                        Follow
                      </button>
                    </div>
                    <span class="author-handle">@meiwrites</span>
                  </div>
                </div>
                <div class="poem-header-right">
                  <div class="poem-timestamp">2 hours ago</div>
                </div>
              </div>
              <div class="poem-body">
                The forest breathes a mist so deep, where distant peaks in
                silence sleep. I leave my worries by the stream, and walk
                inside a waking dream.
              </div>
              <div class="poem-footer-row">
                <div class="poem-actions">
                  <div
                    class="poem-action-item like-btn"
                    data-media-type="banani-button"
                  >
                    <div
                      style="
                        width: 20px;
                        height: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                      "
                    >
                      <iconify-icon
                        icon="lucide:heart"
                        style="font-size: 16px; color: currentColor"
                      ></iconify-icon>
                    </div>
                    <span class="poem-action-count">108</span>
                  </div>
                  <div
                    class="poem-action-item comment-toggle-btn"
                    data-media-type="banani-button"
                  >
                    <div
                      style="
                        width: 20px;
                        height: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                      "
                    >
                      <iconify-icon
                        icon="lucide:message-circle"
                        style="font-size: 16px; color: currentColor"
                      ></iconify-icon>
                    </div>
                    <span class="poem-action-count">14</span>
                  </div>
                  <div
                    class="poem-action-item bookmark-btn"
                    data-media-type="banani-button"
                  >
                    <div
                      style="
                        width: 20px;
                        height: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                      "
                    >
                      <iconify-icon
                        icon="lucide:bookmark"
                        style="font-size: 16px; color: currentColor"
                      ></iconify-icon>
                    </div>
                    <span class="poem-action-count">Save</span>
                  </div>
                  <div class="share-menu-container">
                    <div
                      class="poem-action-item share-btn"
                      data-media-type="banani-button"
                    >
                      <div
                        style="
                          width: 20px;
                          height: 20px;
                          display: flex;
                          align-items: center;
                          justify-content: center;
                        "
                      >
                        <iconify-icon
                          icon="lucide:share-2"
                          style="font-size: 16px; color: currentColor"
                        ></iconify-icon>
                      </div>
                      <span class="poem-action-count">Share</span>
                    </div>
                    <div class="share-menu">
                      <button class="share-menu-item copy-link-btn">
                        <iconify-icon icon="lucide:link"></iconify-icon>
                        Copy Link
                      </button>
                      <div class="share-menu-divider"></div>
                      <a class="share-menu-item" data-share="whatsapp">
                        <iconify-icon icon="mdi:whatsapp"></iconify-icon>
                        WhatsApp
                      </a>
                      <a class="share-menu-item" data-share="instagram">
                        <iconify-icon icon="mdi:instagram"></iconify-icon>
                        Instagram
                      </a>
                      <a class="share-menu-item" data-share="twitter">
                        <iconify-icon icon="mdi:twitter"></iconify-icon>
                        X (Twitter)
                      </a>
                    </div>
                  </div>
                </div>
                <div class="poem-tagline">forest mist Â· quiet awakening</div>
              </div>
              
              <!-- Comments Section -->
              <div class="comments-section">
                <div class="comments-container">
                  <!-- Comment Input -->
                  <div class="comment-input-wrapper">
                    <div class="avatar-circle">
                      <img
                        src="https://storage.googleapis.com/banani-avatars/avatar%2Ffemale%2F25-35%2FEuropean%2F2"
                        alt="Your avatar"
                      />
                    </div>
                    <input type="text" class="comment-input" placeholder="Write a comment..." />
                    <button class="comment-submit-btn">Post</button>
                  </div>
                  
                  <!-- Comment 1 -->
                  <div class="comment-item">
                    <div class="avatar-circle">
                      <img
                        src="https://storage.googleapis.com/banani-avatars/avatar%2Fmale%2F25-35%2FMiddle%20Eastern%2F3"
                        alt="Alex"
                      />
                    </div>
                    <div class="comment-content">
                      <div class="comment-header">
                        <span class="comment-author">Alex Rivers</span>
                        <span class="comment-time">2h ago</span>
                      </div>
                      <div class="comment-text">Beautiful imagery! This really captures the essence of forest solitude.</div>
                      <div class="comment-actions">
                        <span class="comment-action">Reply</span>
                      </div>
                      
                      <!-- Nested Reply -->
                      <div class="comment-replies">
                        <div class="comment-item">
                          <div class="avatar-circle">
                            <img
                              src="https://storage.googleapis.com/banani-avatars/avatar%2Ffemale%2F18-25%2FEast%20Asian%2F3"
                              alt="Mei Ling"
                            />
                          </div>
                          <div class="comment-content">
                            <div class="comment-header">
                              <span class="comment-author">Mei Ling</span>
                              <span class="comment-time">1h ago</span>
                            </div>
                            <div class="comment-text">Thank you so much! ðŸ’™</div>
                            <div class="comment-actions">
                              <span class="comment-action">Reply</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Comment 2 -->
                  <div class="comment-item">
                    <div class="avatar-circle">
                      <img
                        src="https://storage.googleapis.com/banani-avatars/avatar%2Ffemale%2F35-50%2FEuropean%2F4"
                        alt="Sarah"
                      />
                    </div>
                    <div class="comment-content">
                      <div class="comment-header">
                        <span class="comment-author">Sarah Chen</span>
                        <span class="comment-time">3h ago</span>
                      </div>
                      <div class="comment-text">The mist metaphor is so evocative. Reminds me of early morning hikes in the mountains.</div>
                      <div class="comment-actions">
                        <span class="comment-action">Reply</span>
                      </div>
                      
                      <!-- Nested Replies -->
                      <div class="comment-replies">
                        <div class="comment-item">
                          <div class="avatar-circle">
                            <img
                              src="https://storage.googleapis.com/banani-avatars/avatar%2Fmale%2F18-25%2FAfrican%2F2"
                              alt="Marcus"
                            />
                          </div>
                          <div class="comment-content">
                            <div class="comment-header">
                              <span class="comment-author">Marcus J.</span>
                              <span class="comment-time">2h ago</span>
                            </div>
                            <div class="comment-text">Same here! Nature poetry hits different ðŸŒ²</div>
                            <div class="comment-actions">
                              <span class="comment-action">Reply</span>
                            </div>
                          </div>
                        </div>
                        
                        <div class="comment-item">
                          <div class="avatar-circle">
                            <img
                              src="https://storage.googleapis.com/banani-avatars/avatar%2Ffemale%2F18-25%2FEast%20Asian%2F3"
                              alt="Mei Ling"
                            />
                          </div>
                          <div class="comment-content">
                            <div class="comment-header">
                              <span class="comment-author">Mei Ling</span>
                              <span class="comment-time">1h ago</span>
                            </div>
                            <div class="comment-text">I'm so glad it resonates with you both! ðŸŒ¿</div>
                            <div class="comment-actions">
                              <span class="comment-action">Reply</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Comment 3 -->
                  <div class="comment-item">
                    <div class="avatar-circle">
                      <img
                        src="https://storage.googleapis.com/banani-avatars/avatar%2Fmale%2F25-35%2FSouth%20Asian%2F1"
                        alt="Raj"
                      />
                    </div>
                    <div class="comment-content">
                      <div class="comment-header">
                        <span class="comment-author">Raj Patel</span>
                        <span class="comment-time">4h ago</span>
                      </div>
                      <div class="comment-text">This is going in my favorites collection!</div>
                      <div class="comment-actions">
                        <span class="comment-action">Reply</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </article>

            <article class="poem-card" data-media-type="banani-button" data-poem-id="poem2">
              <div class="poem-header-row">
                <div class="poem-author-block">
                  <div class="avatar-circle" onclick="window.location.href='profile.html'">
                    <img
                      src="https://storage.googleapis.com/banani-avatars/avatar%2Fmale%2F35-50%2FEuropean%2F5"
                      alt="Julian Thorne"
                    />
                  </div>
                  <div class="author-meta">
                    <div class="author-name-row">
                      <span class="author-name">Julian Thorne</span>
                      <button
                        class="follow-btn"
                        data-media-type="banani-button"
                      >
                        Follow
                      </button>
                    </div>
                    <span class="author-handle">@jthorne_poet</span>
                  </div>
                </div>
                <div class="poem-header-right">
                  <div class="poem-timestamp">5 hours ago</div>
                </div>
              </div>
              <div class="poem-body">
                Between each thought, a distant bell, a single note in
                midnight blue. I learn to rest inside its swell, where every
                silence feels like dew.
              </div>
              <div class="poem-footer-row">
                <div class="poem-actions">
                  <div
                    class="poem-action-item like-btn"
                    data-media-type="banani-button"
                  >
                    <div
                      style="
                        width: 20px;
                        height: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                      "
                    >
                      <iconify-icon
                        icon="lucide:heart"
                        style="font-size: 16px; color: currentColor"
                      ></iconify-icon>
                    </div>
                    <span class="poem-action-count">264</span>
                  </div>
                  <div
                    class="poem-action-item comment-toggle-btn"
                    data-media-type="banani-button"
                  >
                    <div
                      style="
                        width: 20px;
                        height: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                      "
                    >
                      <iconify-icon
                        icon="lucide:message-circle"
                        style="font-size: 16px; color: currentColor"
                      ></iconify-icon>
                    </div>
                    <span class="poem-action-count">32</span>
                  </div>
                  <div
                    class="poem-action-item bookmark-btn"
                    data-media-type="banani-button"
                  >
                    <div
                      style="
                        width: 20px;
                        height: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                      "
                    >
                      <iconify-icon
                        icon="lucide:bookmark"
                        style="font-size: 16px; color: currentColor"
                      ></iconify-icon>
                    </div>
                    <span class="poem-action-count">Save</span>
                  </div>
                  <div class="share-menu-container">
                    <div
                      class="poem-action-item share-btn"
                      data-media-type="banani-button"
                    >
                      <div
                        style="
                          width: 20px;
                          height: 20px;
                          display: flex;
                          align-items: center;
                          justify-content: center;
                        "
                      >
                        <iconify-icon
                          icon="lucide:share-2"
                          style="font-size: 16px; color: currentColor"
                        ></iconify-icon>
                      </div>
                      <span class="poem-action-count">Share</span>
                    </div>
                    <div class="share-menu">
                      <button class="share-menu-item copy-link-btn">
                        <iconify-icon icon="lucide:link"></iconify-icon>
                        Copy Link
                      </button>
                      <div class="share-menu-divider"></div>
                      <a class="share-menu-item" data-share="whatsapp">
                        <iconify-icon icon="mdi:whatsapp"></iconify-icon>
                        WhatsApp
                      </a>
                      <a class="share-menu-item" data-share="instagram">
                        <iconify-icon icon="mdi:instagram"></iconify-icon>
                        Instagram
                      </a>
                      <a class="share-menu-item" data-share="twitter">
                        <iconify-icon icon="mdi:twitter"></iconify-icon>
                        X (Twitter)
                      </a>
                    </div>
                  </div>
                </div>
                <div class="poem-tagline">stillness Â· inner echo</div>
              </div>
              
              <!-- Comments Section -->
              <div class="comments-section">
                <div class="comment-input-wrapper">
                  <div class="avatar-circle">
                    <img
                      src="https://storage.googleapis.com/banani-avatars/avatar%2Ffemale%2F25-35%2FEuropean%2F2"
                      alt="Your avatar"
                    />
                  </div>
                  <input type="text" class="comment-input" placeholder="Write a comment..." />
                  <button class="comment-submit-btn">Post</button>
                </div>
                <div class="comments-list">
                  <!-- Comments will be added here dynamically -->
                </div>
              </div>
            </article>

            <article class="poem-card" data-media-type="banani-button" data-poem-id="poem3">
              <div class="poem-header-row">
                <div class="poem-author-block">
                  <div class="avatar-circle" onclick="window.location.href='profile.html'">
                    <img
                      src="https://storage.googleapis.com/banani-avatars/avatar%2Ffemale%2F25-35%2FAfrican%2F1"
                      alt="Zara N."
                    />
                  </div>
                  <div class="author-meta">
                    <div class="author-name-row">
                      <span class="author-name">Zara N.</span>
                      <button
                        class="follow-btn"
                        data-media-type="banani-button"
                      >
                        Follow
                      </button>
                    </div>
                    <span class="author-handle">@zara_moon</span>
                  </div>
                </div>
                <div class="poem-header-right">
                  <div class="poem-timestamp">Yesterday</div>
                </div>
              </div>
              <div class="poem-body">
                A river made of midnight glass wanders through my quiet chest;
                every breath, a current passed, every pause, a place to rest.
              </div>
              <div class="poem-footer-row">
                <div class="poem-actions">
                  <div
                    class="poem-action-item like-btn"
                    data-media-type="banani-button"
                  >
                    <div
                      style="
                        width: 20px;
                        height: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                      "
                    >
                      <iconify-icon
                        icon="lucide:heart"
                        style="font-size: 16px; color: currentColor"
                      ></iconify-icon>
                    </div>
                    <span class="poem-action-count">412</span>
                  </div>
                  <div
                    class="poem-action-item comment-toggle-btn"
                    data-media-type="banani-button"
                  >
                    <div
                      style="
                        width: 20px;
                        height: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                      "
                    >
                      <iconify-icon
                        icon="lucide:message-circle"
                        style="font-size: 16px; color: currentColor"
                      ></iconify-icon>
                    </div>
                    <span class="poem-action-count">51</span>
                  </div>
                  <div
                    class="poem-action-item bookmark-btn"
                    data-media-type="banani-button"
                  >
                    <div
                      style="
                        width: 20px;
                        height: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                      "
                    >
                      <iconify-icon
                        icon="lucide:bookmark"
                        style="font-size: 16px; color: currentColor"
                      ></iconify-icon>
                    </div>
                    <span class="poem-action-count">Save</span>
                  </div>
                  <div class="share-menu-container">
                    <div
                      class="poem-action-item share-btn"
                      data-media-type="banani-button"
                    >
                      <div
                        style="
                          width: 20px;
                          height: 20px;
                          display: flex;
                          align-items: center;
                          justify-content: center;
                        "
                      >
                        <iconify-icon
                          icon="lucide:share-2"
                          style="font-size: 16px; color: currentColor"
                        ></iconify-icon>
                      </div>
                      <span class="poem-action-count">Share</span>
                    </div>
                    <div class="share-menu">
                      <button class="share-menu-item copy-link-btn">
                        <iconify-icon icon="lucide:link"></iconify-icon>
                        Copy Link
                      </button>
                      <div class="share-menu-divider"></div>
                      <a class="share-menu-item" data-share="whatsapp">
                        <iconify-icon icon="mdi:whatsapp"></iconify-icon>
                        WhatsApp
                      </a>
                      <a class="share-menu-item" data-share="instagram">
                        <iconify-icon icon="mdi:instagram"></iconify-icon>
                        Instagram
                      </a>
                      <a class="share-menu-item" data-share="twitter">
                        <iconify-icon icon="mdi:twitter"></iconify-icon>
                        X (Twitter)
                      </a>
                    </div>
                  </div>
                </div>
                <div class="poem-tagline">river Â· gentle courage</div>
              </div>
              
              <!-- Comments Section -->
              <div class="comments-section">
                <div class="comment-input-wrapper">
                  <div class="avatar-circle">
                    <img
                      src="https://storage.googleapis.com/banani-avatars/avatar%2Ffemale%2F25-35%2FEuropean%2F2"
                      alt="Your avatar"
                    />
                  </div>
                  <input type="text" class="comment-input" placeholder="Write a comment..." />
                  <button class="comment-submit-btn">Post</button>
                </div>
                <div class="comments-list">
                  <!-- Comments will be added here dynamically -->
                </div>
              </div>
            </article>
          </section>
        </section>
      </main>

      <a href="write.html" class="floating-write-btn" title="Write a poem">
        <iconify-icon
          icon="lucide:feather"
          style="font-size: 28px"
        ></iconify-icon>
      </a>
    </div>

    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script src="api.js"></script>
    <script>
      function toggleDropdown() {
        const dropdown = document.getElementById('profileDropdown');
        dropdown.classList.toggle('show');
      }

      // Close dropdown when clicking outside
      window.addEventListener('click', function(e) {
        if (!e.target.closest('.profile-dropdown')) {
          const dropdown = document.getElementById('profileDropdown');
          dropdown.classList.remove('show');
        }
      });

      // Like/Heart button functionality
      document.addEventListener('click', async function(e) {
        const likeBtn = e.target.closest('.like-btn');
        if (likeBtn) {
          e.stopPropagation();
          
          const poemCard = likeBtn.closest('[data-poem-id]');
          const poemId = poemCard?.getAttribute('data-poem-id');
          
          if (!poemId) return;
          
          const isLiked = likeBtn.classList.contains('liked');
          
          // Optimistic UI update
          likeBtn.classList.toggle('liked');
          
          // Switch icon between outline and filled
          const icon = likeBtn.querySelector('iconify-icon');
          if (icon) {
            if (likeBtn.classList.contains('liked')) {
              icon.setAttribute('icon', 'mdi:heart');
            } else {
              icon.setAttribute('icon', 'lucide:heart');
            }
          }
          
          // Update count
          const countSpan = likeBtn.querySelector('.poem-action-count');
          if (countSpan) {
            let count = parseInt(countSpan.textContent);
            if (likeBtn.classList.contains('liked')) {
              countSpan.textContent = count + 1;
            } else {
              countSpan.textContent = count - 1;
            }
          }
          
          // Call API if authenticated
          if (isAuthenticated()) {
            try {
              if (isLiked) {
                await unlikePoem(poemId);
                removeLikedPoem(poemId);
              } else {
                await likePoem(poemId);
                addLikedPoem(poemId);
              }
            } catch (error) {
              // Revert UI on error
              likeBtn.classList.toggle('liked');
              if (icon) {
                icon.setAttribute('icon', isLiked ? 'mdi:heart' : 'lucide:heart');
              }
              if (countSpan) {
                let count = parseInt(countSpan.textContent);
                countSpan.textContent = isLiked ? count + 1 : count - 1;
              }
              console.error('Failed to update like status');
            }
          }
        }
      });

      // Bookmark button functionality
      document.addEventListener('click', async function(e) {
        const bookmarkBtn = e.target.closest('.bookmark-btn');
        if (bookmarkBtn) {
          e.stopPropagation();
          
          const poemCard = bookmarkBtn.closest('[data-poem-id]');
          const poemId = poemCard?.getAttribute('data-poem-id');
          
          if (!poemId) return;
          
          const isBookmarked = bookmarkBtn.classList.contains('bookmarked');
          
          // Optimistic UI update
          bookmarkBtn.classList.toggle('bookmarked');
          
          // Switch icon between outline and filled
          const icon = bookmarkBtn.querySelector('iconify-icon');
          if (icon) {
            if (bookmarkBtn.classList.contains('bookmarked')) {
              icon.setAttribute('icon', 'mdi:bookmark');
            } else {
              icon.setAttribute('icon', 'lucide:bookmark');
            }
          }
          
          // Update text
          const textSpan = bookmarkBtn.querySelector('.poem-action-count');
          if (textSpan) {
            textSpan.textContent = bookmarkBtn.classList.contains('bookmarked') ? 'Saved' : 'Save';
          }
          
          // Call API if authenticated
          if (isAuthenticated()) {
            try {
              if (isBookmarked) {
                await unbookmarkPoem(poemId);
                removeBookmarkedPoem(poemId);
              } else {
                await bookmarkPoem(poemId);
                addBookmarkedPoem(poemId);
              }
            } catch (error) {
              // Revert UI on error
              bookmarkBtn.classList.toggle('bookmarked');
              if (icon) {
                icon.setAttribute('icon', isBookmarked ? 'mdi:bookmark' : 'lucide:bookmark');
              }
              if (textSpan) {
                textSpan.textContent = isBookmarked ? 'Saved' : 'Save';
              }
              console.error('Failed to update bookmark status');
            }
          }
        }
      });
      
      // Load user interactions and restore state on page load
      window.addEventListener('DOMContentLoaded', async function() {
        if (isAuthenticated()) {
          await loadUserInteractions();
          
          // Restore liked and bookmarked states
          document.querySelectorAll('[data-poem-id]').forEach(poemCard => {
            const poemId = poemCard.getAttribute('data-poem-id');
            
            // Restore like state
            if (isPoemLiked(poemId)) {
              const likeBtn = poemCard.querySelector('.like-btn');
              if (likeBtn) {
                likeBtn.classList.add('liked');
                const icon = likeBtn.querySelector('iconify-icon');
                if (icon) {
                  icon.setAttribute('icon', 'mdi:heart');
                }
              }
            }
            
            // Restore bookmark state
            if (isPoemBookmarked(poemId)) {
              const bookmarkBtn = poemCard.querySelector('.bookmark-btn');
              if (bookmarkBtn) {
                bookmarkBtn.classList.add('bookmarked');
                const icon = bookmarkBtn.querySelector('iconify-icon');
                if (icon) {
                  icon.setAttribute('icon', 'mdi:bookmark');
                }
                const textSpan = bookmarkBtn.querySelector('.poem-action-count');
                if (textSpan) {
                  textSpan.textContent = 'Saved';
                }
              }
            }
          });
        }
      });
      
      // Comment section toggle functionality
      document.addEventListener('click', function(e) {
        const commentBtn = e.target.closest('.comment-toggle-btn');
        if (commentBtn) {
          e.stopPropagation();
          
          const poemCard = commentBtn.closest('.poem-card');
          const commentsSection = poemCard?.querySelector('.comments-section');
          
          if (commentsSection) {
            commentsSection.classList.toggle('expanded');
            commentBtn.classList.toggle('active');
          }
        }
      });

      // Share menu functionality
      document.addEventListener('click', function(e) {
        // Toggle share menu
        const shareBtn = e.target.closest('.share-btn');
        if (shareBtn) {
          e.stopPropagation();
          
          const container = shareBtn.closest('.share-menu-container');
          const shareMenu = container?.querySelector('.share-menu');
          
          if (shareMenu) {
            // Close all other share menus
            document.querySelectorAll('.share-menu.show').forEach(menu => {
              if (menu !== shareMenu) {
                menu.classList.remove('show');
              }
            });
            
            shareMenu.classList.toggle('show');
          }
          return;
        }

        // Handle copy link
        const copyBtn = e.target.closest('.copy-link-btn');
        if (copyBtn) {
          e.stopPropagation();
          
          const poemCard = copyBtn.closest('.poem-card');
          const poemId = poemCard?.getAttribute('data-poem-id');
          const poemUrl = `${window.location.origin}${window.location.pathname}?poem=${poemId}`;
          
          navigator.clipboard.writeText(poemUrl).then(() => {
            const originalText = copyBtn.textContent.trim();
            copyBtn.innerHTML = '<iconify-icon icon="lucide:check"></iconify-icon> Copied!';
            
            setTimeout(() => {
              copyBtn.innerHTML = '<iconify-icon icon="lucide:link"></iconify-icon> Copy Link';
            }, 2000);
          }).catch(err => {
            console.error('Failed to copy:', err);
          });
          return;
        }

        // Handle social media sharing
        const shareItem = e.target.closest('.share-menu-item[data-share]');
        if (shareItem) {
          e.preventDefault();
          e.stopPropagation();
          
          const platform = shareItem.getAttribute('data-share');
          const poemCard = shareItem.closest('.poem-card');
          const poemId = poemCard?.getAttribute('data-poem-id');
          const poemUrl = encodeURIComponent(`${window.location.origin}${window.location.pathname}?poem=${poemId}`);
          const poemText = poemCard?.querySelector('.poem-body')?.textContent?.trim() || '';
          const shareText = encodeURIComponent(`Check out this poem on Poemvy: "${poemText.substring(0, 100)}..."`);
          
          let shareUrl = '';
          
          switch(platform) {
            case 'whatsapp':
              shareUrl = `https://wa.me/?text=${shareText}%20${poemUrl}`;
              break;
            case 'twitter':
              shareUrl = `https://twitter.com/intent/tweet?text=${shareText}&url=${poemUrl}`;
              break;
            case 'instagram':
              // Instagram doesn't support direct web sharing, so copy to clipboard
              const instagramUrl = `${window.location.origin}${window.location.pathname}?poem=${poemId}`;
              navigator.clipboard.writeText(instagramUrl);
              alert('Link copied! You can paste it in Instagram.');
              return;
          }
          
          if (shareUrl) {
            window.open(shareUrl, '_blank', 'width=600,height=400');
          }
          
          // Close the menu
          shareItem.closest('.share-menu')?.classList.remove('show');
          return;
        }

        // Close share menus when clicking outside
        if (!e.target.closest('.share-menu-container')) {
          document.querySelectorAll('.share-menu.show').forEach(menu => {
            menu.classList.remove('show');
          });
        }
      });

      // Comment posting functionality
      document.addEventListener('click', async function(e) {
        const postBtn = e.target.closest('.comment-submit-btn');
        if (postBtn) {
          e.stopPropagation();
          
          const poemCard = postBtn.closest('.poem-card');
          const poemId = poemCard?.getAttribute('data-poem-id');
          const commentInput = postBtn.parentElement.querySelector('.comment-input');
          const commentText = commentInput?.value?.trim();
          
          if (!commentText) {
            alert('Please write a comment before posting.');
            return;
          }
          
          if (!isAuthenticated()) {
            alert('Please log in to comment.');
            return;
          }
          
          // Disable button and show loading state
          const originalText = postBtn.textContent;
          postBtn.disabled = true;
          postBtn.textContent = 'Posting...';
          
          try {
            const response = await addComment(poemId, commentText);
            
            // Clear the input
            commentInput.value = '';
            
            // Add the new comment to the UI
            const commentsContainer = poemCard.querySelector('.comments-container') || poemCard.querySelector('.comments-list');
            if (commentsContainer && response.poem) {
              // Get the latest comment (last one in the array)
              const newComment = response.poem.comments[response.poem.comments.length - 1];
              
              // Create comment HTML
              const commentHTML = `
                <div class="comment-item">
                  <div class="avatar-circle">
                    <img
                      src="https://storage.googleapis.com/banani-avatars/avatar%2Ffemale%2F25-35%2FEuropean%2F2"
                      alt="Your avatar"
                    />
                  </div>
                  <div class="comment-content">
                    <div class="comment-header">
                      <span class="comment-author">You</span>
                      <span class="comment-time">Just now</span>
                    </div>
                    <div class="comment-text">${commentText}</div>
                    <div class="comment-actions">
                      <span class="comment-action">Reply</span>
                    </div>
                  </div>
                </div>
              `;
              
              // Insert the new comment
              if (commentsContainer.classList.contains('comments-container')) {
                // For the first poem with detailed structure
                commentsContainer.insertAdjacentHTML('beforeend', commentHTML);
              } else {
                // For other poems with simple structure
                commentsContainer.insertAdjacentHTML('afterbegin', commentHTML);
              }
              
              // Update comment count if it exists
              const commentCountSpan = poemCard.querySelector('.comment-toggle-btn .poem-action-count');
              if (commentCountSpan) {
                const currentCount = parseInt(commentCountSpan.textContent) || 0;
                commentCountSpan.textContent = currentCount + 1;
              }
            }
            
            // Show success message
            postBtn.textContent = 'Posted!';
            setTimeout(() => {
              postBtn.textContent = originalText;
            }, 2000);
            
          } catch (error) {
            console.error('Error posting comment:', error);
            alert('Failed to post comment. Please try again.');
          } finally {
            postBtn.disabled = false;
            if (postBtn.textContent === 'Posting...') {
              postBtn.textContent = originalText;
            }
          }
        }
      });
    </script>
    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
    <script src="background.js"></script>
  </body>
</html>
